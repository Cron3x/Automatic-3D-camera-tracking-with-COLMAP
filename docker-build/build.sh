#!/bin/env sh

if [[ -d "target" ]]; then
  rm -rf target/
fi

mkdir target/
docker build -t colmap-builder .
docker run --rm -u 0 -v "$(pwd)/target":"/out":Z "colmap_build" \
  sh -c '
cp /home/ubuntu/colmap-3.13.0/build/src/colmap/exe/colmap /out && \
cp /lib/x86_64-linux-gnu/libmkl_intel_lp64.so /out && \
cp /lib/x86_64-linux-gnu/libmkl_intel_thread.so /out && \
cp /lib/x86_64-linux-gnu/libmkl_core.so /out && \
cp /lib/x86_64-linux-gnu/libomp.so.5 /out && \
cp /lib/x86_64-linux-gnu/libGLEW.so.2.2 /out && \
cp /lib/x86_64-linux-gnu/libfreeimage.so.3 /out && \
cp /lib/x86_64-linux-gnu/libmetis.so.5 /out && \
cp /lib/x86_64-linux-gnu/libglog.so.1 /out && \
cp /lib/x86_64-linux-gnu/libceres.so.4 /out && \
cp /lib/x86_64-linux-gnu/libboost_program_options.so.1.83.0 /out && \
cp /lib/x86_64-linux-gnu/libgmp.so.10 /out/ && \
cp /lib/x86_64-linux-gnu/libm.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libGLEW.so.2.2 /out/ && \
cp /lib/x86_64-linux-gnu/libboost_program_options.so.1.83.0 /out/ && \
cp /lib/x86_64-linux-gnu/libceres.so.4 /out/ && \
cp /lib/x86_64-linux-gnu/libsqlite3.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libglog.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libcurl.so.4 /out/ && \
cp /lib/x86_64-linux-gnu/libcrypto.so.3 /out/ && \
cp /lib/x86_64-linux-gnu/libmetis.so.5 /out/ && \
cp /lib/x86_64-linux-gnu/libfreeimage.so.3 /out/ && \
cp /lib/x86_64-linux-gnu/libQt6OpenGLWidgets.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libQt6OpenGL.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libQt6Widgets.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libQt6Gui.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libQt6Core.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libOpenGL.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libstdc++.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libgcc_s.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libdl.so.2 /out/ && \
cp /lib/x86_64-linux-gnu/libpthread.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/librt.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libGL.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libcholmod.so.5 /out/ && \
cp /lib/x86_64-linux-gnu/libspqr.so.4 /out/ && \
cp /lib/x86_64-linux-gnu/liblapack.so.3 /out/ && \
cp /lib/x86_64-linux-gnu/libgflags.so.2.2 /out/ && \
cp /lib/x86_64-linux-gnu/libunwind.so.8 /out/ && \
cp /lib/x86_64-linux-gnu/libnghttp2.so.14 /out/ && \
cp /lib/x86_64-linux-gnu/libidn2.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/librtmp.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libssh.so.4 /out/ && \
cp /lib/x86_64-linux-gnu/libpsl.so.5 /out/ && \
cp /lib/x86_64-linux-gnu/libssl.so.3 /out/&& \
cp /lib/x86_64-linux-gnu/libgssapi_krb5.so.2 /out/ && \
cp /lib/x86_64-linux-gnu/libldap.so.2 /out/ && \
cp /lib/x86_64-linux-gnu/liblber.so.2 /out/ && \
cp /lib/x86_64-linux-gnu/libzstd.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libbrotlidec.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libz.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libjxrglue.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libjpeg.so.8 /out/ && \
cp /lib/x86_64-linux-gnu/libopenjp2.so.7 /out/ && \
cp /lib/x86_64-linux-gnu/libpng16.so.16 /out/ && \
cp /lib/x86_64-linux-gnu/libraw.so.23 /out/ && \
cp /lib/x86_64-linux-gnu/libtiff.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libwebpmux.so.3 /out/ && \
cp /lib/x86_64-linux-gnu/libOpenEXR-3_1.so.30 /out/ && \
cp /lib/x86_64-linux-gnu/libIex-3_1.so.30 /out/ && \
cp /lib/x86_64-linux-gnu/libImath-3_1.so.29 /out/ && \
cp /lib/x86_64-linux-gnu/libEGL.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libfontconfig.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libX11.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libglib-2.0.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libQt6DBus.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libxkbcommon.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libGLX.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libharfbuzz.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libmd4c.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libfreetype.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libicui18n.so.74 /out/ && \
cp /lib/x86_64-linux-gnu/libicuuc.so.74 /out/ && \
cp /lib/x86_64-linux-gnu/libdouble-conversion.so.3 /out/ && \
cp /lib/x86_64-linux-gnu/libb2.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libpcre2-16.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libGLdispatch.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libamd.so.3 /out/ && \
cp /lib/x86_64-linux-gnu/libcolamd.so.3 /out/ && \
cp /lib/x86_64-linux-gnu/libcamd.so.3 /out/ && \
cp /lib/x86_64-linux-gnu/libccolamd.so.3 /out/ && \
cp /lib/x86_64-linux-gnu/libblas.so.3 /out/ && \
cp /lib/x86_64-linux-gnu/libsuitesparseconfig.so.7 /out/ && \
cp /lib/x86_64-linux-gnu/libgomp.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libgfortran.so.5 /out/ && \
cp /lib/x86_64-linux-gnu/liblzma.so.5 /out/ && \
cp /lib/x86_64-linux-gnu/libunistring.so.5 /out/ && \
cp /lib/x86_64-linux-gnu/libgnutls.so.30 /out/ && \
cp /lib/x86_64-linux-gnu/libhogweed.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libnettle.so.8 /out/ && \
cp /lib/x86_64-linux-gnu/libkrb5.so.3 /out/ && \
cp /lib/x86_64-linux-gnu/libk5crypto.so.3 /out/ && \
cp /lib/x86_64-linux-gnu/libcom_err.so.2 /out/ && \
cp /lib/x86_64-linux-gnu/libkrb5support.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libsasl2.so.2 /out/ && \
cp /lib/x86_64-linux-gnu/libbrotlicommon.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libjpegxr.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/liblcms2.so.2 /out/ && \
cp /lib/x86_64-linux-gnu/libwebp.so.7 /out/ && \
cp /lib/x86_64-linux-gnu/libLerc.so.4 /out/ && \
cp /lib/x86_64-linux-gnu/libjbig.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libdeflate.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libIlmThread-3_1.so.30 /out/ && \
cp /lib/x86_64-linux-gnu/libexpat.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libxcb.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libpcre2-8.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libdbus-1.so.3 /out/ && \
cp /lib/x86_64-linux-gnu/libgraphite2.so.3 /out/ && \
cp /lib/x86_64-linux-gnu/libbz2.so.1.0 /out/ && \
cp /lib/x86_64-linux-gnu/libicudata.so.74 /out/ && \
cp /lib/x86_64-linux-gnu/libp11-kit.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libtasn1.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libkeyutils.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libresolv.so.2 /out/ && \
cp /lib/x86_64-linux-gnu/libsharpyuv.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libXau.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libXdmcp.so.6 /out/ && \
cp /lib/x86_64-linux-gnu/libsystemd.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libffi.so.8 /out/ && \
cp /lib/x86_64-linux-gnu/libbsd.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libcap.so.2 /out/ && \
cp /lib/x86_64-linux-gnu/libgcrypt.so.20 /out/ && \
cp /lib/x86_64-linux-gnu/liblz4.so.1 /out/ && \
cp /lib/x86_64-linux-gnu/libmd.so.0 /out/ && \
cp /lib/x86_64-linux-gnu/libgpg-error.so.0 /out/ && \
cp /usr/lib/x86_64-linux-gnu/libmkl_def.so /out/
'
#cp /lib/x86_64-linux-gnu/libcudart.so.12 /out/ && \
